<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Engineering · Retail Decision Intelligence</title>
  <meta name="description" content="DuckDB-WASM in-browser analytics architecture, tech stack, design decisions, and getting started guide." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg: '#0A0F1E', card: '#131929', raised: '#1A2338',
            indigo: { DEFAULT: '#6366F1', light: '#818CF8', dark: '#4F46E5' },
            emerald: { DEFAULT: '#10B981', light: '#34D399' },
            amber: { DEFAULT: '#F59E0B' }, rose: { DEFAULT: '#F43F5E', light: '#FB7185' },
          },
          fontFamily: { sans: ['Inter', 'system-ui'], mono: ['"JetBrains Mono"', 'monospace'] }
        }
      }
    }
  </script>
  <style>
    body { background-color: #0A0F1E; color: #F8FAFC; font-family: 'Inter', system-ui; -webkit-font-smoothing: antialiased; }
    ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .fade-up { animation: fadeUp 0.6s ease both; }
    pre { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; background: #0D1425; border: 1px solid rgba(255,255,255,0.07); border-radius: 12px; padding: 1rem; overflow-x: auto; line-height: 1.6; color: #94A3B8; }
    code { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; background: rgba(99,102,241,0.12); color: #818CF8; padding: 0.15em 0.4em; border-radius: 4px; }
  
    /* mobile-friendly patch v1 */
    @media (max-width: 900px) {
      html, body { overflow-x: hidden; }
      nav, .site-nav { padding-left: 0.75rem !important; padding-right: 0.75rem !important; }
      .nav-inner, nav > div { padding-left: 0.75rem !important; padding-right: 0.75rem !important; }
      .nav-links { display: none !important; }
      .hamburger { display: block !important; }
      .mobile-menu { display: none; }
      .mobile-menu.open { display: flex !important; }
      .content, .page-body, section, main, .hero { padding-left: 1rem !important; padding-right: 1rem !important; }
      .hero { padding-top: 2.5rem !important; }
      .hero h1, h1 { font-size: clamp(1.5rem, 7vw, 2.1rem) !important; line-height: 1.2 !important; }
      h2 { font-size: clamp(1.25rem, 5.2vw, 1.7rem) !important; }
      .kpis-inner, .opp-grid, .value-grid, .big-number-row, .cards-grid, .grid, [class*='grid-cols-'] {
        grid-template-columns: 1fr !important;
      }
      .metric-card, .value-card, .card, .big-number { padding: 1rem !important; }
      .btn, button, a[role='button'], .nav-links a, .mobile-menu a { min-height: 44px; }
      .quote-block, .what-block, .opp-stat-block { padding: 1rem !important; }
    }
    @media (max-width: 520px) {
      body { font-size: 15px; }
      .tag, .section-label { font-size: 0.68rem !important; }
    }

  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel">
    const { useState } = React;

    const NAV_LINKS = [
      { href: './perspectives/index.html', label: 'Perspectives' },
      { href: './engineering.html', label: 'Engineering', current: true },
      { href: './product.html', label: 'Product' },
      { href: './capability.html', label: 'Capability' },
      { href: './executive.html', label: 'Executive' },
    ];

    const Nav = () => {
      const [open, setOpen] = useState(false);
      return (
        <nav className="sticky top-0 z-50 border-b border-white/[0.06] bg-bg/90 backdrop-blur-md">
          <div className="mx-auto flex max-w-7xl items-center justify-between px-4 py-3 md:px-8">
            <a href="https://arvind3.github.io/retail_analytics/#/" className="text-sm font-semibold text-indigo hover:text-indigo-light transition">Retail Decision Intelligence</a>
            <button onClick={() => setOpen(!open)} className="flex h-11 w-11 items-center justify-center rounded-lg text-slate-400 hover:bg-white/[0.04] md:hidden">
              {open ? <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                     : <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>}
            </button>
            <div className="hidden md:flex gap-1">
              {NAV_LINKS.map(l => <a key={l.href} href={l.href} className={`px-3 py-1.5 rounded-full text-sm transition ${l.current ? 'bg-indigo text-white' : 'text-slate-400 hover:text-white hover:bg-white/[0.05]'}`}>{l.label}</a>)}
            </div>
          </div>
          {open && <div className="md:hidden border-t border-white/[0.06] px-4 pb-4 pt-2 flex flex-col gap-1">
            {NAV_LINKS.map(l => <a key={l.href} href={l.href} className={`min-h-[44px] flex items-center px-3 text-sm rounded-lg ${l.current ? 'text-indigo-light' : 'text-slate-300 hover:text-white hover:bg-white/[0.04]'}`}>{l.label}</a>)}
          </div>}
        </nav>
      );
    };

    const STACK = [
      { name: 'React 18', color: '#38BDF8', desc: 'Component UI with HashRouter for SPA navigation on GitHub Pages static hosting.' },
      { name: 'TypeScript 5', color: '#818CF8', desc: 'End-to-end strict type safety from data layer through UI components.' },
      { name: 'Vite 5', color: '#FBBF24', desc: 'Sub-second HMR during development, optimized static build with source maps.' },
      { name: 'Tailwind CSS 3', color: '#34D399', desc: 'Utility-first dark analytics design system with custom color tokens.' },
      { name: 'DuckDB-WASM 1.29', color: '#6366F1', desc: 'Columnar WebAssembly SQL engine. Analytical queries execute entirely in the browser.' },
      { name: 'ECharts 5', color: '#FB7185', desc: 'High-performance canvas-based charts: line, bar, heatmap, Pareto, scatter.' },
      { name: 'Parquet', color: '#F59E0B', desc: 'Columnar binary format. 5-10× smaller than JSON, enables predicate pushdown in DuckDB.' },
      { name: 'GitHub Actions', color: '#94A3B8', desc: 'Full CI/CD: lint → typecheck → unit tests → E2E with Playwright → deploy to Pages.' },
    ];

    const DECISIONS = [
      {
        title: 'HashRouter vs. History API',
        why: 'GitHub Pages serves only index.html at the root. History API routes return 404 on deep-link or refresh. HashRouter keeps all routing in the URL fragment, which is never sent to the server.',
        code: '// vite.config.ts\nbase: "./"  // relative — works at any Pages subdirectory depth',
      },
      {
        title: 'Parquet over JSON',
        why: 'Parquet is columnar: DuckDB can scan only the columns a query needs. JSON requires full deserialization. Result: 5-10× smaller payloads, faster first-query latency.',
        code: '// prepare_data.py\ndf.to_parquet("public/data/parquet/transactions.parquet", engine="pyarrow")',
      },
      {
        title: 'IndexedDB Table Cache',
        why: 'Parquet files are fetched once and stored in IndexedDB via idb-keyval. Navigating between app routes does not re-fetch. Cache is invalidated by metadata.generated_at timestamp.',
        code: '// src/lib/cache.ts\nawait set(cacheKey, buffer);  // idb-keyval stores ArrayBuffer\nconst hit = await get(cacheKey);',
      },
      {
        title: 'Relative Vite Base (./)' ,
        why: 'GitHub Pages deploys to /retail_analytics/. An absolute base would hard-code that path. Relative base (./assets/...) resolves correctly from any subdirectory depth.',
        code: '// dist/index.html (built output)\n<script type="module" src="./assets/index-HASH.js"><\/script>',
      },
      {
        title: 'docs/ co-deployed with dist/',
        why: 'GitHub Pages can only serve one source. Copying docs/ into dist/ before upload means both the React app and static HTML documentation pages are served from the same deployment.',
        code: '# .github/workflows/deploy.yml\n- name: Copy docs into dist\n  run: |\n    if [ -d "docs" ]; then\n      cp -r docs dist/docs\n    fi',
      },
    ];

    const App = () => (
      <div style={{ minHeight: '100vh', background: '#0A0F1E' }}>
        <div className="h-px bg-gradient-to-r from-transparent via-indigo to-transparent" />
        <Nav />

        {/* Hero */}
        <section className="mx-auto max-w-4xl px-4 pt-16 pb-12 md:px-8">
          <div className="fade-up inline-flex items-center gap-2 rounded-full border border-indigo/40 bg-indigo/10 px-4 py-1.5 text-xs font-semibold uppercase tracking-wider text-indigo-light mb-4">
            Engineering Perspective
          </div>
          <h1 className="text-3xl font-bold tracking-tight text-slate-50 md:text-4xl lg:text-5xl">
            DuckDB-WASM In-Browser<br className="hidden sm:inline" /> Analytical Runtime
          </h1>
          <p className="mt-4 max-w-2xl text-lg text-slate-400">
            Zero-backend columnar SQL analytics executed natively in the browser via WebAssembly,
            delivering sub-second query latency against Parquet datasets without cloud infrastructure.
          </p>
        </section>

        {/* Architecture Diagram */}
        <section className="mx-auto max-w-5xl px-4 pb-14 md:px-8">
          <h2 className="text-xl font-semibold text-slate-50 mb-6">Architecture</h2>
          <div className="rounded-2xl border border-white/[0.08] bg-card p-6 md:p-8">
            <div className="flex flex-col gap-4">
              {[
                { layer: 'Data Source', items: ['completejourney dataset', 'Python / pyarrow'], color: '#94A3B8' },
                { layer: 'Build Pipeline', items: ['prepare_data.py → Parquet', 'Vite build → dist/'], color: '#F59E0B' },
                { layer: 'GitHub Pages CDN', items: ['Static file serving', 'dist/ + dist/docs/'], color: '#10B981' },
                { layer: 'Browser Runtime', items: ['DuckDB-WASM engine', 'SQL execution layer', 'ECharts 5 visualizations', 'React 18 + HashRouter'], color: '#6366F1' },
              ].map((l, i) => (
                <div key={l.layer} className="flex flex-col gap-2 sm:flex-row sm:items-center">
                  <div className="shrink-0 w-36 text-xs font-semibold uppercase tracking-wider" style={{ color: l.color }}>{l.layer}</div>
                  <div className="flex flex-wrap gap-2">
                    {l.items.map(item => (
                      <span key={item} className="rounded-full border border-white/[0.08] bg-raised px-3 py-1 text-xs text-slate-300">{item}</span>
                    ))}
                  </div>
                  {i < 3 && <div className="hidden sm:block text-slate-600 ml-2">→</div>}
                </div>
              ))}
            </div>
            <div className="mt-6 flex flex-wrap gap-2">
              {['Zero server', 'Zero database cluster', 'Zero backend API'].map(z => (
                <span key={z} className="rounded-full border border-emerald/30 bg-emerald/10 px-3 py-1 text-xs font-semibold text-emerald-light">{z}</span>
              ))}
            </div>
          </div>
        </section>

        {/* Tech Stack */}
        <section className="mx-auto max-w-5xl px-4 pb-14 md:px-8">
          <h2 className="text-xl font-semibold text-slate-50 mb-6">Tech Stack</h2>
          <div className="grid gap-3 sm:grid-cols-2 lg:grid-cols-4">
            {STACK.map(s => (
              <div key={s.name} className="rounded-xl border border-white/[0.08] bg-card p-4">
                <div className="text-sm font-semibold" style={{ color: s.color }}>{s.name}</div>
                <p className="mt-1.5 text-xs text-slate-400 leading-relaxed">{s.desc}</p>
              </div>
            ))}
          </div>
        </section>

        {/* How It Works */}
        <section className="mx-auto max-w-5xl px-4 pb-14 md:px-8">
          <h2 className="text-xl font-semibold text-slate-50 mb-6">How It Works</h2>
          <div className="space-y-4">
            {[
              { step: '01', title: 'Data Preparation', code: '# scripts/prepare_data.py\nimport pyarrow as pa, pyarrow.parquet as pq\npq.write_table(table, "public/data/parquet/transactions.parquet")' },
              { step: '02', title: 'Static Build', code: '# npm run build → dist/\n# DuckDB-WASM bundles are copied by Vite\n# Parquet files served as static assets' },
              { step: '03', title: 'Browser Loads DuckDB-WASM', code: '// src/lib/duckdb.ts\nconst worker = await duckdb.createWorker(bundle.mainWorker);\nconst db = new duckdb.AsyncDuckDB(logger, worker);\nawait db.instantiate(bundle.mainModule);' },
              { step: '04', title: 'Parquet Registered as Tables', code: "// ensureTables([\"transactions\"])\nawait conn.query(\n  `CREATE TABLE IF NOT EXISTS transactions AS\n   SELECT * FROM parquet_scan('./data/parquet/transactions.parquet')`\n);" },
              { step: '05', title: 'SQL Executes In-Browser', code: '// runQuery(sql) → QueryResult\nconst result = await conn.query(sql);\nconst rows = result.toArray().map(r => r.toJSON());' },
            ].map(s => (
              <div key={s.step} className="rounded-xl border border-white/[0.08] bg-card p-5">
                <div className="flex items-center gap-3 mb-3">
                  <span className="text-xs font-bold text-indigo-light font-mono">{s.step}</span>
                  <span className="text-sm font-semibold text-slate-200">{s.title}</span>
                </div>
                <div className="overflow-x-auto"><pre>{s.code}</pre></div>
              </div>
            ))}
          </div>
        </section>

        {/* Key Design Decisions */}
        <section className="mx-auto max-w-5xl px-4 pb-14 md:px-8">
          <h2 className="text-xl font-semibold text-slate-50 mb-6">Key Design Decisions</h2>
          <div className="space-y-4">
            {DECISIONS.map(d => (
              <div key={d.title} className="rounded-xl border border-white/[0.08] bg-card p-5">
                <div className="text-sm font-semibold text-slate-100 mb-2">{d.title}</div>
                <p className="text-sm text-slate-400 mb-3">{d.why}</p>
                <div className="overflow-x-auto"><pre>{d.code}</pre></div>
              </div>
            ))}
          </div>
        </section>

        {/* Getting Started */}
        <section className="mx-auto max-w-5xl px-4 pb-16 md:px-8">
          <h2 className="text-xl font-semibold text-slate-50 mb-6">Getting Started</h2>
          <div className="rounded-xl border border-white/[0.08] bg-card p-6">
            <div className="overflow-x-auto">
              <pre>{`# 1. Clone and install
git clone https://github.com/arvind3/retail_analytics.git
cd retail_analytics
npm install

# 2. Prepare the dataset (Python 3.11+)
pip install pandas pyarrow pyreadr
npm run prepare:data

# 3. Start local dev server
npm run dev
# → http://localhost:5173/

# 4. Full validation before push
npm run lint && npm run typecheck && npm run test:unit
npm run e2e  # builds + runs Playwright`}</pre>
            </div>
          </div>
        </section>

        {/* CTA */}
        <section className="border-t border-white/[0.06] px-4 py-12 text-center">
          <a href="https://github.com/arvind3/retail_analytics"
            className="inline-flex items-center gap-2 rounded-full border border-white/[0.10] bg-white/[0.04] px-6 py-3 text-sm font-semibold text-slate-300 transition hover:border-indigo hover:text-white">
            View source on GitHub →
          </a>
        </section>

        <footer className="border-t border-white/[0.06] px-4 py-6 text-center">
          <p className="text-xs text-slate-600">
            <a href="https://github.com/arvind3/retail_analytics" className="hover:text-slate-400 transition">github.com/arvind3/retail_analytics</a>
            {' · '}
            <a href="https://arvind3.github.io/retail_analytics/#/" className="hover:text-slate-400 transition">Live Demo</a>
          </p>
        </footer>
      </div>
    );

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
